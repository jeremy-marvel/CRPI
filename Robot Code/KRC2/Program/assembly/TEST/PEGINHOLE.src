&ACCESS RVP
&REL 91
&PARAM TEMPLATE = C:\KRC\Roboter\Template\vorgabe
&PARAM EDITMASK = *
DEF PEGINHOLE( )
DECL FRAME PT1
DECL BOOL TEMP
DECL BOOL STATE

DECL IPO_MODE LAST_IPO
;FOLD INI
  ;FOLD BASISTECH INI
    GLOBAL INTERRUPT DECL 3 WHEN $STOPMESS==TRUE DO IR_STOPM ( )
    INTERRUPT ON 3 
    BAS (#INITMOV,0 )
  ;ENDFOLD (BASISTECH INI)
  ;FOLD USER INI
    ;Make your modifications here

  ;ENDFOLD (USER INI)
;ENDFOLD (INI)

$TOOL=TOOL_DATA[5]
$VEL.CP=.2
$VEL.ORI1=100
$VEL.ORI2=100
$ACC.CP=1.0
$ACC.ORI1=80
$ACC.ORI2=80
$ADVANCE=5

;FOLD PTP P0 Vel=100 % PDAT0 Tool[5]:Pneumatic_gripper_probe Base[0];%{PE}%R 5.6.11,%MKUKATPBASIS,%CMOVE,%VPTP,%P 1:PTP, 2:P0, 3:, 5:100, 7:PDAT0
$BWDSTART=FALSE
PDAT_ACT=PPDAT0
FDAT_ACT=FP0
BAS(#PTP_PARAMS,100)
PTP XP0 
;ENDFOLD


;PT1=GETPOINT("Z", -1)
;PTP PT1

LIN_REL{X -40}


TEMP=TRIG()
TEMP=SETSTIFF("Z", 10.0)

LIN_REL{Z -121}

STATE = STARTIMPEDANCE(TRUE)

WAIT SEC 2

LAST_IPO = $IPO_MODE
$IPO_MODE = #TCP

; Clear all search parameters
STATE = CANCEL_SEARCH()


; Alarm clock test:  Passed
STATE = STATE AND ADDTERMCLOCK(#ALARMCLOCK, #FAIL, 10000.0, 5)

; Spiral Test
;BOOL ADDSEARCHSPIRAL(INT TURNS, REAL RADIUS, REAL SPEED)
STATE = ADDSEARCHSPIRAL(5, 40.0, 100.0)

; Alarm clock test:  Passed
;STATE = STATE AND ADDTERMCLOCK(#ALARMCLOCK, #FAIL, 10000.0, 5)

WHILE STATE
  STATE = (SEARCH() == #RUNNING)
ENDWHILE

WAIT SEC 2

TEMP=FORCEZSTOP()
$STIFFNESS.STRATEGY=10
$STIFFNESS.COMMIT=TRUE

STATE=STARTIMPEDANCE(FALSE)

STATE = CANCEL_SEARCH()
WAIT SEC 2


 ;FOLD PTP P1 Vel=100 % PDAT1 Tool[5]:Pneumatic_gripper_probe Base[0];%{PE}%R 5.6.11,%MKUKATPBASIS,%CMOVE,%VPTP,%P 1:PTP, 2:P1, 3:, 5:100, 7:PDAT1
$BWDSTART=FALSE
PDAT_ACT=PPDAT1
FDAT_ACT=FP1
BAS(#PTP_PARAMS,100)
PTP XP1 
;ENDFOLD


END